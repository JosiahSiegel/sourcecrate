<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free academic paper search engine. Search 9 databases simultaneously (arXiv, PubMed, CrossRef, OpenAlex) for instant PDF downloads. 100% client-side, privacy-focused.">
    <title>SourceCrate - Academic Paper Research</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <!-- Modular CSS - Loaded in parallel for optimal performance -->
    <!-- Base Styles -->
    <link rel="stylesheet" href="css/base/variables.css">
    <link rel="stylesheet" href="css/base/reset.css">
    <link rel="stylesheet" href="css/base/animations.css">
    <!-- Layout -->
    <link rel="stylesheet" href="css/layout/container.css">
    <link rel="stylesheet" href="css/layout/header.css">
    <link rel="stylesheet" href="css/layout/footer.css">
    <link rel="stylesheet" href="css/layout/sections.css">
    <!-- Components -->
    <link rel="stylesheet" href="css/components/forms-buttons.css">
    <link rel="stylesheet" href="css/components/papers.css">
    <link rel="stylesheet" href="css/components/tier1-features.css">
    <link rel="stylesheet" href="css/components/scroll-button.css">
    <link rel="stylesheet" href="css/components/sponsor.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>SourceCrate</h1>
        </header>

        <main>
            <!-- Search Section -->
            <section class="search-section">
                <form id="searchForm">
                    <div class="search-input-wrapper">
                        <div class="search-input">
                            <input
                                type="text"
                                id="searchQuery"
                                role="combobox"
                                placeholder="Search papers (e.g., machine learning, DOI, author)"
                                required
                                autocomplete="off"
                                aria-controls="searchHistoryDropdown"
                                aria-expanded="false"
                                aria-haspopup="listbox"
                            >
                        </div>
                        <!-- Search History Dropdown -->
                        <div id="searchHistoryDropdown" class="search-history-dropdown" style="display: none;">
                            <div class="search-history-header">
                                <span>Recent Searches</span>
                                <button type="button" id="clearHistoryBtn" class="clear-history-btn" title="Clear history" tabindex="-1">Clear</button>
                            </div>
                            <ul id="searchHistoryList" class="search-history-list" role="listbox"></ul>
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="checkbox" id="pdfOnly">
                        <label for="pdfOnly">Only Direct Download</label>
                    </div>
                    <div class="search-actions">
                        <button type="submit" class="btn btn-primary">Search</button>
                        <button type="button" id="viewBookmarksBtn" class="btn btn-secondary" title="View saved papers">
                            ★ Bookmarks (<span id="bookmarkCount">0</span>)
                        </button>
                    </div>
                </form>
                <!-- Live region for screen reader announcements -->
                <div id="searchStatusLive"
                     class="sr-only"
                     role="status"
                     aria-live="polite"
                     aria-atomic="true"></div>
            </section>


            <!-- Results Section -->
            <section class="results-section">
                <!-- Results Controls Row -->
                <div id="resultsControlsRow" class="results-controls-row" style="display: none;">
                    <div class="controls-inline">
                        <input
                            type="text"
                            id="resultsSearchInput"
                            class="search-minimal"
                            placeholder="Filter results..."
                            autocomplete="off"
                        >
                        <div class="sort-dropdown-wrapper">
                            <button type="button" id="resultsSortDropdownBtn" class="sort-dropdown-btn">Sort ▾</button>
                            <div id="resultsSortDropdownMenu" class="sort-dropdown-menu" style="display: none;">
                                <button type="button" data-sort="relevance-desc">Relevance</button>
                                <button type="button" data-sort="citations-desc">Citations ↓</button>
                                <button type="button" data-sort="citations-asc">Citations ↑</button>
                                <button type="button" data-sort="year-desc">Year ↓</button>
                                <button type="button" data-sort="year-asc">Year ↑</button>
                                <button type="button" data-sort="title-asc">A-Z</button>
                                <button type="button" data-sort="title-desc">Z-A</button>
                            </div>
                        </div>
                        <div class="export-dropdown-wrapper">
                            <button type="button" id="resultsExportDropdownBtn" class="export-dropdown-btn">Export ▾</button>
                            <div id="resultsExportDropdownMenu" class="export-dropdown-menu" style="display: none;">
                                <button type="button" id="copyResultsBtn">⧉ Copy</button>
                                <div class="export-dropdown-separator"></div>
                                <button type="button" data-format="plaintext">Plain Text</button>
                                <button type="button" data-format="bibtex">BibTeX</button>
                                <button type="button" data-format="ris">RIS</button>
                                <button type="button" data-format="csv">CSV</button>
                                <button type="button" data-format="json">JSON</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="results" class="results-container">
                    <p class="placeholder">Search results will appear here</p>
                </div>
            </section>

            <!-- Bookmarks Section -->
            <section id="bookmarksSection" class="bookmarks-section" style="display: none;">
                <!-- Minimal Header -->
                <div class="bookmarks-header-minimal">
                    <h2>SAVED PAPERS</h2>
                    <a href="#" id="backToSearchLink" class="back-link">← Back</a>
                </div>

                <!-- Minimalistic Progress Bar (Always Visible) -->
                <div class="reading-progress-minimal">
                    <div class="progress-label">
                        <span id="progressCollectionName">All Papers</span>
                        <span id="progressPercentText">0%</span>
                    </div>
                    <div class="reading-progress-bar-minimal">
                        <div class="progress-bar-fill-minimal" id="progressBarFill" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Collections and Controls (Single Row) -->
                <div class="bookmarks-controls-row">
                    <div class="collections-inline">
                        <span id="collectionsInline">
                            <!-- Collections will be rendered as plain text -->
                        </span>
                        <a href="#" id="newCollectionLink" class="new-collection-link">+ New</a>
                    </div>
                    <div class="controls-inline">
                        <input
                            type="text"
                            id="bookmarksSearchInput"
                            class="search-minimal"
                            placeholder="Search..."
                            autocomplete="off"
                        >
                        <div class="status-filter-dropdown-wrapper">
                            <button type="button" id="statusFilterDropdownBtn" class="status-filter-dropdown-btn">Status: All ▾</button>
                            <div id="statusFilterDropdownMenu" class="status-filter-dropdown-menu" style="display: none;">
                                <button type="button" data-status="all">All</button>
                                <button type="button" data-status="to_read"><span class="status-icon">○</span> To Read</button>
                                <button type="button" data-status="reading"><span class="status-icon">◐</span> Reading</button>
                                <button type="button" data-status="read"><span class="status-icon">●</span> Read</button>
                                <button type="button" data-status="important"><span class="status-icon">★</span> Important</button>
                            </div>
                        </div>
                        <div class="sort-dropdown-wrapper">
                            <button type="button" id="sortDropdownBtn" class="sort-dropdown-btn">Sort ▾</button>
                            <div id="sortDropdownMenu" class="sort-dropdown-menu" style="display: none;">
                                <button type="button" data-sort="date-desc">Newest</button>
                                <button type="button" data-sort="date-asc">Oldest</button>
                                <button type="button" data-sort="title-asc">A-Z</button>
                                <button type="button" data-sort="title-desc">Z-A</button>
                                <button type="button" data-sort="year-desc">Year ↓</button>
                                <button type="button" data-sort="year-asc">Year ↑</button>
                            </div>
                        </div>
                        <div class="export-dropdown-wrapper">
                            <button type="button" id="exportDropdownBtn" class="export-dropdown-btn">Export ▾</button>
                            <div id="exportDropdownMenu" class="export-dropdown-menu" style="display: none;">
                                <button type="button" id="copyBookmarksBtn">⧉ Copy</button>
                                <div class="export-dropdown-separator"></div>
                                <button type="button" data-format="plaintext">Plain Text</button>
                                <button type="button" data-format="bibtex">BibTeX</button>
                                <button type="button" data-format="ris">RIS</button>
                                <button type="button" data-format="csv">CSV</button>
                                <button type="button" data-format="json">JSON</button>
                                <div class="export-dropdown-separator"></div>
                                <button type="button" id="clearAllBookmarksBtn">Clear All</button>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="bookmarks-separator">

                <div id="bookmarksResults" class="results-container">
                    <p class="placeholder">No bookmarked papers yet. Star papers from search results to save them here!</p>
                </div>
            </section>

            <!-- Create Collection Modal -->
            <div id="createCollectionModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Create New Collection</h3>
                        <button type="button" class="modal-close" aria-label="Close">×</button>
                    </div>
                    <form id="createCollectionForm">
                        <div class="form-group">
                            <label for="collectionName">Collection Name</label>
                            <input
                                type="text"
                                id="collectionName"
                                placeholder="e.g., Literature Review"
                                required
                                autocomplete="off"
                            >
                        </div>
                        <div class="form-group">
                            <label for="collectionDescription">Description (optional)</label>
                            <textarea
                                id="collectionDescription"
                                placeholder="Brief description of this collection..."
                                rows="3"
                            ></textarea>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary" id="cancelCollectionBtn">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Create Collection
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </main>

        <footer>
            <p>
                SourceCrate · Academic Paper Research ·
                <a href="sponsors.html" class="footer-sponsor-link">
                    ❤️ Sponsor
                </a>
            </p>
        </footer>
    </div>

    <!-- Scroll to Top Button -->
    <button id="scrollToTopBtn" class="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">
        ↑
    </button>

    <!-- Paper Card Template (cloned for performance, saves 15KB JS) -->
    <template id="paper-card-template">
        <div class="paper-card paper-card-streaming">
            <div class="paper-header">
                <div class="paper-title-row">
                    <h3>
                        <span class="title-search-icon" tabindex="0" role="button" aria-label="Search for similar papers" data-title="">🔍</span>
                        <span data-slot="title"></span>
                    </h3>
                </div>
            </div>
            <div class="paper-meta">
                <span class="meta-item" data-slot="authors"></span>
                <span class="meta-item" data-slot="year-journal"></span>
            </div>
            <div class="research-metadata-badges" data-slot="badges"></div>
            <p class="paper-abstract" data-slot="abstract"></p>
            <div class="paper-links" data-slot="links"></div>
        </div>
    </template>

    <!--
        Optional: Load config.js to override API URL
        - Local dev: auto-generated by local-manager.sh with localhost:9000
        - Production: file doesn't exist (404), state.js auto-detection handles it
    -->
    <script src="config.js"></script>

    <!-- Load modular ES6 app -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
